name: Deploy to Pantheon

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Setup SSH
        env:
          PANTHEON_SSH_KEY: ${{ secrets.PANTHEON_SSH_KEY }}
        run: |
          mkdir -p ~/.ssh
          echo "$PANTHEON_SSH_KEY" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -p 2222 -H codeserver.dev.eb98ad70-d952-4c72-96a4-fec5a23350f1.drush.in >> ~/.ssh/known_hosts
      
      - name: Deploy to Pantheon Dev
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          git remote add pantheon ssh://codeserver.dev.eb98ad70-d952-4c72-96a4-fec5a23350f1@codeserver.dev.eb98ad70-d952-4c72-96a4-fec5a23350f1.drush.in:2222/~/repository.git
          git push pantheon HEAD:master --force
      
      - name: Deployment status
        run: echo "âœ… Deployed to Pantheon Dev environment"